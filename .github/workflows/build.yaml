name: Translate Plugins

on:
  workflow_dispatch:
#  schedule:
#    - cron: '0 0 * * *' # æ¯å¤© UTC 0 é»

permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          persist-credentials: true
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.12'
      - name: Install dependencies
        run: pip install requests
      - name: Run translation script
        run: python translate_plugins.py
      - name: Commit & Push
        run: |
          git config user.name "GitHub Action"
          git config user.email "action@github.com"
          git add Hans/**/* Hant/**/* translation/**/* dict/**/*
          git add dict_string.json dict_url.json
          git commit -m "ç¹åŒ–æ›´æ–°" || echo "No changes to commit"
          git push
      - name: Create/Update Release and Upload Assets
        uses: marvinp/release-asset-update-action@v5.0.0
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          # 1. å¦‚æœé€™å€‹ Tag (latest-plugins) å­˜åœ¨ï¼Œå‰‡ä½¿ç”¨å®ƒä¸¦è¦†è“‹ Asset
          # 2. å¦‚æœé€™å€‹ Tag ä¸å­˜åœ¨ï¼Œå‰‡è‡ªå‹•å»ºç«‹ä¸€å€‹æ–°çš„ Release
          tag: latest-plugins
          # Release çš„æ¨™é¡Œï¼Œåªåœ¨ç¬¬ä¸€æ¬¡å»ºç«‹ Release æ™‚ä½¿ç”¨
          name: ğŸ› ï¸ ç¹é«”åŒ–å¤–æ›æœ€æ–°ç‰ˆ (è‡ªå‹•æ›´æ–°)
          # Release çš„æè¿°ï¼Œåªåœ¨ç¬¬ä¸€æ¬¡å»ºç«‹ Release æ™‚ä½¿ç”¨
          body: |
            æ­¤ Release æœƒè‡ªå‹•è¦†è“‹æ›´æ–°ï¼Œå§‹çµ‚æä¾›æœ€æ–°çš„ç¹é«”åŒ–å¤–æ› ZIP æª”æ¡ˆã€‚
          # è¨­å®šç‚º true ä»¥ç¢ºä¿å¦‚æœ Release å·²ç¶“å­˜åœ¨ï¼Œæˆ‘å€‘å¯ä»¥è¦†è“‹ Assets
          overwrite: true
          # é€™è£¡æŒ‡å®šè¦ä¸Šå‚³çš„æª”æ¡ˆè·¯å¾‘ï¼Œå®ƒæœƒæ‰¾åˆ°æ‰€æœ‰ releases è³‡æ–™å¤¾ä¸‹çš„ ZIP æª”æ¡ˆ
          files: releases/**/*.zip
